import time
import random
from pynput import keyboard
from Quartz import CGEventCreateKeyboardEvent, CGEventPost, kCGHIDEventTap

# MIRROR KIA EXAMPLE
# Whenever left shift is pressed, right shift is injected. Same goes with release.

# Key code for Shift (macOS common)
SHIFT_KEY = 60

shift_pressed = False

def human_delay():
    time.sleep(random.uniform(0.001, 0.03))
    
def inject_shift_press():
    human_delay()
    event = CGEventCreateKeyboardEvent(None, SHIFT_KEY, True)
    CGEventPost(kCGHIDEventTap, event)
    print(f"Injected Shift Press")

def inject_shift_release():
    human_delay()
    event = CGEventCreateKeyboardEvent(None, SHIFT_KEY, False)
    CGEventPost(kCGHIDEventTap, event)
    print(f"Injected Shift Release")

def on_press(key):
    global shift_pressed
    try:
        if key == keyboard.Key.shift and not shift_pressed:
            shift_pressed = True
            inject_shift_press()
    except Exception as e:
        print(f"on_press error: {e}")

def on_release(key):
    global shift_pressed
    try:
        if key == keyboard.Key.shift and shift_pressed:
            shift_pressed = False
            inject_shift_release()
    except Exception as e:
        print(f"on_release error: {e}")

# Start the listener
with keyboard.Listener(on_press=on_press, on_release=on_release) as listener:
    print("Listening for Shift key events...")
    listener.join()
